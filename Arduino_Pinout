// ESP32 Pin Finder v3 â€” avoids TX0/RX0, handles input-only pins cleanly.
#include <vector>
using std::vector;

// Pullup-capable (safe to touch to GND). Skips 1/3 and 6..11.
vector<int> withPullup = {
  0, 2, 4, 5,
  12, 13, 14, 15,
  16, 17, 18, 19,
  21, 22, 23,
  25, 26, 27,
  32, 33
};

// Input-only (no pullups/downs; touch to 3V3 to read HIGH)
vector<int> inputOnly = {34, 35, 36, 39};

void setup() {
  Serial.begin(115200);
  delay(200);
  Serial.println("\nPin Finder v3");
  Serial.println("- Touch listed GPIOs to GND to print them.");
  Serial.println("- Touch 34/35/36/39 to 3V3 to print them.");
  for (int p : withPullup) pinMode(p, INPUT_PULLUP);
  for (int p : inputOnly)  pinMode(p, INPUT);
}

void waitRelease(int pin, int level) {
  // wait until pin leaves 'level' (simple debounce)
  unsigned long t0 = millis();
  while (digitalRead(pin) == level && millis() - t0 < 2000) delay(10);
  delay(200);
}

void loop() {
  // Detect LOW on pullup-capable pins (touch to GND)
  for (int p : withPullup) {
    if (digitalRead(p) == LOW) {
      Serial.printf("Grounded -> GPIO %d\n", p);
      waitRelease(p, LOW);
    }
  }
  // Detect HIGH on input-only pins (touch to 3V3)
  for (int p : inputOnly) {
    if (digitalRead(p) == HIGH) {
      Serial.printf("High (3V3) -> GPIO %d\n", p);
      waitRelease(p, HIGH);
    }
  }
}
